  console.log
    
    === SEQUENTIAL ROLLBACK ENFORCEMENT TEST ===

      at Object.log (tests/integration/rollback-sequential-enforcement.test.ts:25:13)

  console.log
    ðŸ“¥ Executing FIRST import...

      at Object.log (tests/integration/rollback-sequential-enforcement.test.ts:42:13)

  console.log
    [ImportService] Starting import execution...

      at ImportService.log [as executeImport] (src/services/excel/import/ImportService.ts:50:15)

  console.log
    [ImportService] Changes: {
      totalAdds: 5,
      totalUpdates: 0,
      totalDeletes: 0,
      totalUnchanged: 0,
      totalChanges: 5,
      changesBySheet: { parts: 5, vehicleApplications: 0, crossReferences: 0 }
    }

      at ImportService.log [as executeImport] (src/services/excel/import/ImportService.ts:51:15)

  console.log
    [ImportService] Snapshot stats: { parts: 882, vehicle_applications: 1000, cross_references: 1000 }

      at ImportService.log [as createSnapshot] (src/services/excel/import/ImportService.ts:172:15)

  console.log
    [ImportService] Pre-import snapshot created

      at ImportService.log [as executeImport] (src/services/excel/import/ImportService.ts:55:15)

  console.log
    [ImportService] Executing atomic import transaction...

      at ImportService.log [as executeBulkOperations] (src/services/excel/import/ImportService.ts:211:13)

  console.log
    [ImportService] Transaction payload: {
      partsToAdd: 5,
      partsToUpdate: 0,
      vehiclesToAdd: 0,
      vehiclesToUpdate: 0,
      crossRefsToAdd: 0,
      crossRefsToUpdate: 0
    }

      at ImportService.log [as executeBulkOperations] (src/services/excel/import/ImportService.ts:301:13)

  console.log
    [ImportService] Attempt 1/3...

      at ImportService.log [as executeBulkOperations] (src/services/excel/import/ImportService.ts:316:17)

FAIL tests/integration/rollback-sequential-enforcement.test.ts
  Sequential Rollback Enforcement
    Ã— should reject rollback if newer imports exist (sequential enforcement) (778 ms)

  â— Sequential Rollback Enforcement â€º should reject rollback if newer imports exist (sequential enforcement)

    Transaction failed after 1 attempt(s): duplicate key value violates unique constraint "idx_parts_sku_tenant"

    [0m [90m 349 |[39m         [36mconst[39m isRetryable [33m=[39m [36mthis[39m[33m.[39misRetryableError(lastError)[33m;[39m
     [90m 350 |[39m         [36mif[39m ([33m![39misRetryable [33m||[39m attempt [33m===[39m maxRetries) {
    [31m[1m>[22m[39m[90m 351 |[39m           [36mthrow[39m [36mnew[39m [33mError[39m(
     [90m     |[39m                 [31m[1m^[22m[39m
     [90m 352 |[39m             [32m`Transaction failed after ${attempt} attempt(s): ${lastError.message}`[39m
     [90m 353 |[39m           )[33m;[39m
     [90m 354 |[39m         }[0m

      at ImportService.executeBulkOperations (src/services/excel/import/ImportService.ts:351:17)
      at ImportService.executeImport (src/services/excel/import/ImportService.ts:58:7)
      at Object.<anonymous> (tests/integration/rollback-sequential-enforcement.test.ts:53:27)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 1 total
Snapshots:   0 total
Time:        1.775 s
Ran all test suites matching tests/integration/rollback-sequential-enforcement.test.ts.
